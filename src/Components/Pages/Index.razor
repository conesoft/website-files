@page "/{*Path}"

@using Conesoft.Website.Files.Components.Controls
@using Conesoft.Website.Files.Components.Controls.Viewers
@using Conesoft.Website.Files.Services

@inject FileHostingPaths paths
@inject NavigationManager navigation

@rendermode InteractiveServer

<MetaData Path="@Path" />
<BreadCrumbs Path="@Path" />

<CascadingAuthenticationState>
    <AuthorizeView>
        <Authorized>
            @if (paths.EntriesAt(Path).Any(e => e.IsFile) == false)
            {
                <DirectoryListing Path="@Path" />
            }
            else
            {
                @if (Path != null && (Path.EndsWith(".mkv") || Path.EndsWith(".mp4")))
                {
                    <VideoPlayer Url="@Path" />
                }
                else if (Path != null && (Path.EndsWith(".txt") || Path.EndsWith(".nfo")))
                {
                    <TextFileViewer Url="@Path" />
                }
                else if (Path != null && (Path.EndsWith(".jpg") || Path.EndsWith(".jpeg") || Path.EndsWith(".png")))
                {
                    <ImageViewer Url="@Path" />
                }
                else if (Path != null && (Path.EndsWith(".log")))
                {
                    <LogFileViewer Url="@Path" />
                }
                else
                {
                    if (string.IsNullOrWhiteSpace(Path) == false)
                    {
                        <main>
                            <section>
                                <ul>
                                    <li>
                                        <p>go to: <a href="/*/@Path">@Path</a></p>
                                    </li>

                                </ul>
                            </section>
                        </main>
                    }
                }
            }
        </Authorized>
    </AuthorizeView>
</CascadingAuthenticationState>

@code
{
    [Parameter] public string? Path { get; set; } = "";
}
